<!DOCTYPE html>
<html>
<head>
    <title>Insurance App</title>
    <meta charset="utf-8">
	<link href=
	"data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/gwD//4MA//+DAP//gwD//4MA//+DAP//gwD/AAAAAP+DAP//gwD//4MA//+DAP//gwD//4MA//+DAP8AAAAA/4MA//+DAP//gwD//4MA//+DAP//gwD//4MA/wAAAAD/gwD//4MA//+DAP//gwD//4MA//+DAP//gwD/AAAAAP+DAP//gwD//4MA//+DAP//gwD//4MA//+DAP8AAAAA/4MA//+DAP//gwD//4MA//+DAP//gwD//4MA/wAAAAD/gwD//4MA//+DAP//gwD//4MA//+DAP//gwD/AAAAAP+DAP//gwD//4MA//+DAP//gwD//4MA//+DAP8AAAAA/4MA//+DAP//gwD//4MA//+DAP//gwD//4MA/wAAAAD/gwD//4MA//+DAP//gwD//4MA//+DAP//gwD/AAAAAP+DAP//gwD//4MA//+DAP//gwD//4MA//+DAP8AAAAA/4MA//+DAP//gwD//4MA//+DAP//gwD//4MA/wAAAAD/gwD//4MA//+DAP//gwD//4MA//+DAP//gwD/AAAAAP+DAP//gwD//4MA//+DAP//gwD//4MA//+DAP8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/gwD//4MA//+DAP//gwD//4MA//+DAP//gwD/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/4MA//+DAP//gwD//4MA//+DAP//gwD//4MA/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP+DAP//gwD//4MA//+DAP//gwD//4MA//+DAP8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/gwD//4MA//+DAP//gwD//4MA//+DAP//gwD/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/4MA//+DAP//gwD//4MA//+DAP//gwD//4MA/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP+DAP//gwD//4MA//+DAP//gwD//4MA//+DAP8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/gwD//4MA//+DAP//gwD//4MA//+DAP//gwD/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEAAAEBAAABAQAAAQEAAAEBAAABAQAAAQEAAP//AADwHwAA8B8AAPAfAADwHwAA8B8AAPAfAADwHwAA//8AAA=="
	rel="shortcut icon" type="image/x-icon" />
    <script src="//ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <style>
        .singleContractEditForm { display: none; }
        input:invalid {
            border-color: red;
        }
        input,
        input:valid {
            border-color: #ccc;
        }
    </style>
</head>
<body>
<div class="allContractsView">
    <p>
        <button onclick="getPrefilledContract()">Создать договор</button>
        <button onclick="getContractById(123)">Открыть договор</button>
        <!--<br>будущая форма <a href="contractFormDesign.html" target="_blank"> создания и редактирования договора</a>
        <br><button onclick="getAllContracts()">Test: getAllContracts()</button>-->
    </p>
    <!-- Вывод всех существующих договор, в обратном порядке (id desc) (прийдет отсортированный с бека) -->
    <table border="1" id="allContractsTableId">
        <thead>
        <tr>
            <th>Серия-Номер</th>
            <th>Дата заключения</th>
            <th>Страхователь</th>
            <th>Премия</th>
            <th>Срок действия</th>
        </tr>
        </thead>
    </table>
</div>
<div class="singleContractEditForm">
    <fieldset>
        <legend>Расчет</legend>
        <p><label for="insuranceAmount">Страховая сумма</label><input type="text" id="insuranceAmount"></p>
        <p><label for="realtyType">Тип недвижимости</label><input type="text" id="realtyType"></p>
        <p><label for="realtyeBuildYear">Год постройки</label><input type="text" id="realtyeBuildYear"></p>
        <p><label for="realtyArea">Площадь, кв.м.</label><input type="text" id="realtyArea"></p>
        <p><label for="insuranceStartDate">Срок действия с</label><input type="date" id="insuranceStartDate"></p>
        <p><label for="insuranceEndDate"> по </label><input type="date" id="insuranceEndDate"></p>
        <p><button onclick="console.log('Провалидировать, и если ок - отправляем на сервер для расчета. Ответ выводим в нижеследующие поля')">Рассчитать</button></p>
        <p><label for="insuranceCalcDate">Дата расчета</label><input type="text" id="insuranceCalcDate"></p>
        <p><label for="insurancePremium">Премия</label><input type="text" id="insurancePremium"></p>
    </fieldset>
    <p>
        <label for="insuranceContractId">№ договора</label>
        <!--14--  № договора	Целое	Доступно	Обязательное	Ввод с клавиатуры		Номер договора должен состоять из 6 цифр, номера договоров не должны повторяться -->
        <!--условие <не должны повторяться> будем проверять на беке при сохранении. Либо нужен отдельный рест для проверки. Считаю вообще не целесообразным вводить вручную номер договора,
         возможно ошибка в требованиях, уточнить -->
        <input type="text" id="insuranceContractId" pattern="[0-9]{6}" title="Номер договора должен состоять из 6 цифр, номера договоров не должны повторяться">

        <label for="insuranceContractDate" required>Дата заключения</label>
        <!--15-- Дата заключения	Дата	Нет	Обязательное	Присваивается системой	Текущая дата	 -->
        <!--нужно будет засетить value, данные взять или из префила, либо системное время на фронте-->
        <input type="date" id="insuranceContractDate" value="2018-07-22" readonly></p>

    <p><b>СТРАХОВАТЕЛЬ</b></p>
    <p><button id="openSearchHolderDialog">Выбрать</button><label for="holderFullName"> ФИО </label><input type="text" id="holderFullName"><button>Изменить</button></p>
    <p><label for="holderBirthDate">Дата рождения</label><input type="date" id="holderBirthDate">
        <label for="holderPassportSeries"> Паспорт серия </label><input type="text" id="holderPassportSeries">
        <label for="holderPassportNumber"> номер </label><input type="text" id="holderPassportNumber">
    </p>
    <p><b>Адрес недвижимости</b></p><!-- RealtyLocation -->
    <table>
        <tr>
            <td>
                <select id="country">
                    <option>Russia</option>
                    <option>Other</option>
                </select>
            </td>
            <td>
                <input type="text" id="postIndex">
            </td>
            <td>
                <input type="text" id="federalRegion">
            </td>
            <td>
                <input type="text" id="district">
            </td>
        </tr>
        <tr>
            <td>
                <label for="country">государство</label>
            </td>
            <td>
                <label for="postIndex">индекс</label>
            </td>
            <td>
                <label for="federalRegion">республика, край, область</label>
            </td>
            <td>
                <label for="district">район</label>
            </td>
        </tr>
    </table>
    <table>
        <tr>
            <td>
                <input type="text" id="place">
            </td>
            <td>
                <input type="text" id="street">
            </td>
            <td>
                <input type="text" id="houseNumber">
            </td>
            <td>
                <input type="text" id="houseBlock">
            </td>
            <td>
                <input type="text" id="building">
            </td>
            <td>
                <input type="text" id="apartment">
            </td>
        </tr>
        <tr>
            <td>
                <label for="place">населенный пункт</label>
            </td>
            <td>
                <label for="street">улица</label>
            </td>
            <td>
                <label for="houseNumber">дом</label>
            </td>
            <td>
                <label for="houseBlock">корпус</label>
            </td>
            <td>
                <label for="building">строение</label>
            </td>
            <td>
                <label for="apartment">квартира</label>
            </td>
        </tr>
    </table>
    <p><b>КОММЕНТАРИЙ</b></p>
    <table>
        <tr>
            <td align="right" valign="top">
                комментарий к<br/> договору (не<br/> печатается на<br/> полисе)
            </td>
            <td>
                <textarea rows="5" cols="100" name="text" id="contractComment"></textarea>
            </td>
        </tr>
    </table>
    <p><button>Сохранить</button><button onclick="returnToAllContractsView()">К списку договоров</button></p>
</div>

<!-- [Форма поиска клиента] - открыите по кнопке <Выбрать> в блоке СТРАХОВАТЕЛИ
Группа полей / Поле	        Тип поля	Продавец:           Продавец: 	        Способ указания значения	Значение, указываемое при открытии страницы	Прочие особенности поведения
                                        Доступность         Обязательность
                                        для редактирования
39--[Форма поиска клиента]
40--Фамилия	                Строка	    Доступно	        Нет	                Ввод с клавиатуры
41--Имя	                    Строка	    Доступно	        Нет	                Ввод с клавиатуры
42--Отчество	            Строка	    Доступно	        Нет	                Ввод с клавиатуры
43--ФИО	                    Строка	    Нет	                Нет	                Присваивается системой		Подставляются данные из клиента
44--Дата рождения	        Строка	    Нет	                Нет	                Присваивается системой		Подставляются данные из клиента
45--Паспортные данные	    Строка	    Нет	                Нет	                Присваивается системой		Подставляются данные из клиента
46--Лупа	                Кнопка	    Доступно				                                            Поиск по указанным ФИО, если ничего не введено, то отображаться всех клиентов
47--Выбрать/Новый/Закрыть	Кнопки	    Доступно
-->
<dialog id="searchHolderDialog">
    <table>
        <tr>
            <td>ФИО</td>
            <td>
                <input type="text" id="lastName">
            </td>
            <td>
                <input type="text" id="firstName">
            </td>
            <td>
                <input type="text" id="parentName">
            </td>
            <td><button>Поиск</button></td>
        </tr>
        <tr>
            <td></td>
            <td>
                <label for="lastName">(фамилия)</label>
            </td>
            <td>
                <label for="firstName">(имя)</label>
            </td>
            <td>
                <label for="parentName">(отчество)</label>
            </td>
            <td></td>
        </tr>
    </table>
    <div class="holdersView">
        <table id="holdersDictTableId">
            <thead>
            <tr>
                <th>ФИО</th>
                <th>Дата рождения</th>
                <th>Паспортные данные</th>
            </tr>
            </thead>
        </table>
    </div>
    <div class="emptyHoldersView">Нет подходящих записей</div>
    <p><button id="openExistingHolderDialog">Выбрать</button>
        <button id="openCreateNewHolderDialog">Новый</button>
        <button id="closeSearchHolderDialog">Закрыть</button></p>
</dialog>

<dialog id="existingHolderDialog">
    <table>
        <tr>
            <td>ФИО</td>
            <td>
                <input type="text" id="openHolderLastName">
            </td>
            <td>
                <input type="text" id="openHolderFirstName">
            </td>
            <td>
                <input type="text" id="openHolderParentName">
            </td>
        </tr>
        <tr>
            <td></td>
            <td>
                <label for="openHolderLastName">(фамилия)</label>
            </td>
            <td>
                <label for="openHolderFirstName">(имя)</label>
            </td>
            <td>
                <label for="openHolderParentName">(отчество)</label>
            </td>
        </tr>
    </table>
    <p><label for="openHolderBirthDate">Дата рождения</label><input type="date" id="openHolderBirthDate"></p>
    <p><label for="openHolderPassportSeries"> Паспорт серия </label><input type="text" id="openHolderPassportSeries">
    <label for="openHolderPassportNumber"> номер </label><input type="text" id="openHolderPassportNumber"></p>
    <p><button id="getAndCloseExistingHolderDialog">Сохранить</button><button id="closeExistingHolderDialog">Отменить</button></p>
</dialog>

<dialog id="createNewHolderDialog">
    <table>
        <tr>
            <td>ФИО</td>
            <td>
                <input type="text" id="newHolderLastName">
            </td>
            <td>
                <input type="text" id="newHolderFirstName">
            </td>
            <td>
                <input type="text" id="newHolderParentName">
            </td>
        </tr>
        <tr>
            <td></td>
            <td>
                <label for="newHolderLastName">(фамилия)</label>
            </td>
            <td>
                <label for="newHolderFirstName">(имя)</label>
            </td>
            <td>
                <label for="newHolderParentName">(отчество)</label>
            </td>
        </tr>
    </table>
    <p><label for="newHolderBirthDate">Дата рождения</label><input type="date" id="newHolderBirthDate"></p>
    <p><label for="newHolderPassportSeries"> Паспорт серия </label><input type="text" id="newHolderPassportSeries">
        <label for="newHolderPassportNumber"> номер </label><input type="text" id="newHolderPassportNumber"></p>
    <p><button id="saveAndCloseExistingHolderDialog">Сохранить</button><button id="closeCreateNewHolderDialog">Отменить</button></p>
</dialog>

<script>
    (function (){
        getAllContracts(); // пагинация нужна ? пока обойдемся без нее
    }());

    function getAllContracts()
    {
        $.ajax({
            type: "GET",
            contentType: "application/json",
            url: "insurance/contract/",
            cache: false,
            success: function(allContracts){
                $("#allContractsTableId > tbody").remove(); //почистить таблицу
                //заполнить полученными данными
                $('#allContractsTableId').append(
                    `<tbody>${allContracts.map(n =>
                        `<tr>
                          <td>${n.contractId}</td>
                          <td>${n.contractDate}</td>
                          <td>${n.policyHolder}</td>
                          <td>${n.premium}</td>
                          <td>${n.contractDuration}</td>
                        </tr>`).join('')}
                      </tbody>`
                                    );
            }
        });
    }

    function getPrefilledContract()
    {
        console.log('По этой кнопке открываем модалку и подгружаем GET /insurance/contracts/{id} - только id надо выбрать из таблицы, если null - то дизейблить кнопку');
        $.ajax({
            type: "GET",
            contentType: "application/json",
            url: "insurance/contract/prefill",
            cache: false,
            success: function(prefilledContract){
                //console.log(prefilledContract);
                openContractEditForm(prefilledContract);
            }
        });
    }

    function getContractById(id)
    {
        console.log('По этой кнопке открываем модалку и дергаем GET /insurance/contracts/prefill');
        $.ajax({
            type: "GET",
            contentType: "application/json",
            url: "insurance/contract/" + id,
            cache: false,
            success: function(contract){
                //console.log(contract);
                openContractEditForm(contract);
            }
        });
    }

    function openContractEditForm(contract)
    {
        $('.singleContractEditForm').show();
        $('.allContractsView').hide();
        console.log(contract); //TO DO: заполнить форму
    }

    function returnToAllContractsView()
    {
        $('.singleContractEditForm').hide();    //скрыть блок редактирования (вернее все что class = "singleContractEditForm")
        $('.allContractsView').show();          //отобразить блок просмотра списка все договоров (вернее все что class = "allContractsView")
    }

    var searchHoldersDialog = document.querySelector('#searchHolderDialog');
    document.querySelector('#openSearchHolderDialog').onclick = function() {
        searchHoldersDialog.showModal();
    }
    document.querySelector('#closeSearchHolderDialog').onclick = function() {
        searchHoldersDialog.close();
    }

    var existingHolderDialog = document.querySelector('#existingHolderDialog');
    document.querySelector('#openExistingHolderDialog').onclick = function() {
        existingHolderDialog.showModal();
    }
    document.querySelector('#closeExistingHolderDialog').onclick = function() {
        existingHolderDialog.close();
    }
    document.querySelector('#getAndCloseExistingHolderDialog').onclick = function() {
        //передать в модель договора
        existingHolderDialog.close();
    }

    var createNewHolderDialog = document.querySelector('#createNewHolderDialog');
    document.querySelector('#openCreateNewHolderDialog').onclick = function() {
        createNewHolderDialog.showModal();
    }
    document.querySelector('#closeCreateNewHolderDialog').onclick = function() {
        createNewHolderDialog.close();
    }
    document.querySelector('#saveAndCloseExistingHolderDialog').onclick = function() {
        //сохранить на сервере
        //передать в модель договора
        createNewHolderDialog.close();
    }
</script>
</body>
</html>
